define(["jquery","pages/spark/app","js/lib/cookie","js/lib/modals","spark/app/signature/js/signatureTrackLastChanceModal.html","spark/app/signature/js/signatureTrackLastChanceModal2.html","js/lib/coursera.ab"],function($,Coursera,Cookie,Modal,signatureTrackLastChanceModal,signatureTrackLastChanceModal2,AB){if(Coursera.user.get("last_access_time")){var signup_url=Coursera.course.get("host")+"signature/course/"+Coursera.course.get("shortname")+"/"+Coursera.course.get("id"),sigtrackStatus=Coursera.course.get("signatureTrackStatus");if(1===sigtrackStatus.signature_track_enabled)if(1===sigtrackStatus.signature_track_sign_up_now&&!Coursera.user.inSignatureTrack()){if(1!=Cookie.get("spark_signaturetrack_hide")){var join_st_label="Earn a Verified Certificate for this course!",join_st_button="Get Started",expSigtrackModalShowcert=AB.session.getExperiment("sigtrack_modal_showcert").getChosenVariant();$("body").prepend("<div class='course-signaturetrack-topbanner'>  <span class='course-signaturetrack-topbanner-close'>    <a href='#'>&times;</a>  </span>  <span class='course-signaturetrack-topbanner-text'>"+join_st_label+"  </span>"+"  <span class='course-signaturetrack-topbanner-button'>"+"    <a target='_new' href='"+signup_url+"?utm_source=spark&utm_medium=banner"+"'>"+join_st_button+"</a>"+"  </span>"+"</div>"),$(".course-signaturetrack-topbanner-close").click(function(){$(".course-signaturetrack-topbanner").hide(),Cookie.set("spark_signaturetrack_hide",1,{expires:new Date("2020"),path:"/"+Coursera.course.get("sessionName")})})}var makeLastChanceModal=function(arg){if("text"===expSigtrackModalShowcert)return $(signatureTrackLastChanceModal({ribbon:arg.ribbon,timeLeft:arg.timeLeft,studentName:arg.studentName,courseName:arg.courseName}));else return $(signatureTrackLastChanceModal2({ribbon:arg.ribbon,universityLogo:arg.universityLogo,certBaseImage:arg.certBaseImage,studentName:arg.studentName,courseName:arg.courseName}))};if(sigtrackStatus.signature_track_last_chance_dialog&&!Coursera.user.get("last_chance_modal")&&!Coursera.user.isAdmin()){var $modalDiv=makeLastChanceModal({ribbon:Coursera.course.get("assetUnversionedLink")+"/pages/signature/views/ribbon_stripes.png",timeLeft:sigtrackStatus.signature_track_duration_left,courseName:Coursera.course.get("name"),studentName:Coursera.user.get("full_name"),certBaseImage:Coursera.course.get("assetUnversionedLink")+"/images/signature/template-cert-preview.png",universityLogo:Coursera.course.get("host")+"/maestro/api/course/"+Coursera.course.get("id")+"/university_logo"}),modal=new Modal($modalDiv,{"overlay.class":"coursera-signature-modal-overlay-darker","overlay.close":!1});modal.on("open",function(){$(".course-signaturetrack-modal-learnmore").on("click",function(){window.open(signup_url+"?utm_source=spark&utm_medium=lastchance")})}),modal.on("close",function(){$.get("/"+Coursera.course.get("sessionName")+"/signature/api/user/set_last_chance")}),modal.open()}}}});